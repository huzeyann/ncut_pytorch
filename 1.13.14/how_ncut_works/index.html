
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Normalized Cut and NystrÃ¶m Approximation - v1.13.14">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../compare/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>How NCUT Works - NystrÃ¶m Normalized Cuts PyTorch</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8CPZDV5GR1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8CPZDV5GR1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8CPZDV5GR1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-ncut-works" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NystrÃ¶m Normalized Cuts PyTorch" class="md-header__button md-logo" aria-label="NystrÃ¶m Normalized Cuts PyTorch" data-md-component="logo">
      
  <img src="../images/ncut.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NystrÃ¶m Normalized Cuts PyTorch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How NCUT Works
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/huzeyann/ncut_pytorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ncut_pytorch
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NystrÃ¶m Normalized Cuts PyTorch" class="md-nav__button md-logo" aria-label="NystrÃ¶m Normalized Cuts PyTorch" data-md-component="logo">
      
  <img src="../images/ncut.svg" alt="logo">

    </a>
    NystrÃ¶m Normalized Cuts PyTorch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/huzeyann/ncut_pytorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ncut_pytorch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href=".." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Install & Quick Start
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Install & Quick Start
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    How NCUT Works
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    How NCUT Works
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#normalized-cuts-and-spectral-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      Normalized Cuts and Spectral Clustering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Normalized Cuts and Spectral Clustering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-basic-idea" class="md-nav__link">
    <span class="md-ellipsis">
      The Basic Idea
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-graph-laplacian" class="md-nav__link">
    <span class="md-ellipsis">
      The Graph Laplacian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalized-cuts" class="md-nav__link">
    <span class="md-ellipsis">
      Normalized Cuts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solving-the-normalized-cut-using-eigenvectors" class="md-nav__link">
    <span class="md-ellipsis">
      Solving the Normalized Cut Using Eigenvectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solving the Normalized Cut Using Eigenvectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mathematical-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Mathematical Formulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proof-of-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      Proof of Minimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplacian-vs-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      Laplacian vs Affinity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eigenvectors-and-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      Eigenvectors and Clustering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-eigenvector-visualization" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Eigenvector Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-good-eigenvector-solver" class="md-nav__link">
    <span class="md-ellipsis">
      A Good Eigenvector Solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nystrom-like-approximation" class="md-nav__link">
    <span class="md-ellipsis">
      Nystrom-like Approximation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nystrom-like Approximation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sub-sampling-the-affinity-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-sampling the Affinity Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-good-sampling-strategy-fps" class="md-nav__link">
    <span class="md-ellipsis">
      A Good Sampling Strategy: FPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accounting-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting for Indirect Connections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Accounting for Indirect Connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-case-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Example Case for Indirect Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-computation-loads-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Reduce Computation Loads for Indirect Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k-nearest-neighbors-knn-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      K-Nearest Neighbors (KNN) Propagation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizing-ncut-eigenvectors" class="md-nav__link">
    <span class="md-ellipsis">
      Visualizing NCUT Eigenvectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visualizing NCUT Eigenvectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nystrom-approximation-for-t-sne-and-umap" class="md-nav__link">
    <span class="md-ellipsis">
      Nystrom Approximation for t-SNE and UMAP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCUT and t-SNE/UMAP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Gallery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gallery_dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gallery - Dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gallery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gallery - Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gallery_application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_to_get_better_segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to Get Better Segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alignedcut_vs_ncut/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aligned NCUT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../speed_and_performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speed and Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gradient_of_ncut/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gradient of NCUT
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 1 - Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 2 - Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 3 - Add Nodes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mixing_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 4 - Mixing Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../coloring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 5 - Coloring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../application_segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application - Point Prompting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCUT APIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backbones/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backbone APIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trouble_shooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install Trouble Shooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Demo
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#normalized-cuts-and-spectral-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      Normalized Cuts and Spectral Clustering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Normalized Cuts and Spectral Clustering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-basic-idea" class="md-nav__link">
    <span class="md-ellipsis">
      The Basic Idea
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-graph-laplacian" class="md-nav__link">
    <span class="md-ellipsis">
      The Graph Laplacian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalized-cuts" class="md-nav__link">
    <span class="md-ellipsis">
      Normalized Cuts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solving-the-normalized-cut-using-eigenvectors" class="md-nav__link">
    <span class="md-ellipsis">
      Solving the Normalized Cut Using Eigenvectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solving the Normalized Cut Using Eigenvectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mathematical-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Mathematical Formulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proof-of-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      Proof of Minimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplacian-vs-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      Laplacian vs Affinity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eigenvectors-and-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      Eigenvectors and Clustering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-eigenvector-visualization" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Eigenvector Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-good-eigenvector-solver" class="md-nav__link">
    <span class="md-ellipsis">
      A Good Eigenvector Solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nystrom-like-approximation" class="md-nav__link">
    <span class="md-ellipsis">
      Nystrom-like Approximation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nystrom-like Approximation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sub-sampling-the-affinity-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Sub-sampling the Affinity Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-good-sampling-strategy-fps" class="md-nav__link">
    <span class="md-ellipsis">
      A Good Sampling Strategy: FPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accounting-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting for Indirect Connections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Accounting for Indirect Connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-case-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Example Case for Indirect Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reduce-computation-loads-for-indirect-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Reduce Computation Loads for Indirect Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k-nearest-neighbors-knn-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      K-Nearest Neighbors (KNN) Propagation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizing-ncut-eigenvectors" class="md-nav__link">
    <span class="md-ellipsis">
      Visualizing NCUT Eigenvectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visualizing NCUT Eigenvectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nystrom-approximation-for-t-sne-and-umap" class="md-nav__link">
    <span class="md-ellipsis">
      Nystrom Approximation for t-SNE and UMAP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="how-ncut-works">How NCUT works</h1>
<div class="warning" style='padding:0.1em; background-color:#E9D8FD; color:#69337A'>
<span>
<p style='margin-top:1em; text-align:center'>
<b>PROCEDURE <a href="./how_ncut_works">How NCUT Works</a></b></p>
<p style='margin-left:1em;'>
1. <b>Feature Extraction</b>: extract feature for every image frame or text token.</br>
2. <b>NCUT</b>: compute k NCUT eigenvectors, each node is a latent-pixel or text token. </br>
3. <b>spectral-tSNE</b>: reduce k eigenvectors to 3D, plot as RGB image.  </br>
</p>
</p></span>
</div>

<p>This Guide covers:</p>
<ul>
<li>
<p>How <strong>NCUT</strong> works, in math and coding example</p>
</li>
<li>
<p>Scale up NCUT with <strong>Nystrom approximation</strong></p>
</li>
<li>
<p><strong>spectral-tSNE</strong>: Plot NCUT eigenvectors as RGB image</p>
</li>
</ul>
<h2 id="normalized-cuts-and-spectral-clustering">Normalized Cuts and Spectral Clustering</h2>
<p>Spectral clustering, or Normalized Cuts, clusters data based on the eigenvectors (spectrum) of a similarity matrix derived from the data. The Normalized Cuts algorithm aims to partition a graph into subgraphs while minimizing the graph cut value.</p>
<div style="text-align: center;">
<img src="../images/graph_cut.png" style="width:100%;">
</div>
<p>Image taken from <a href="https://medium.com/@roiyeho/spectral-clustering-50aee862d300">Spectral Clustering: Step-by-step derivation of the spectral clustering algorithm including an implementation in Python</a></p>
<hr />
<h3 id="the-basic-idea">The Basic Idea</h3>
<p>Spectral clustering works by embedding the data points <span class="arithmatex">\(F \in \mathbb{R}^{N \times 768}\)</span> into a lower-dimensional space using the eigenvectors of a Laplacian matrix derived from the data's similarity graph <span class="arithmatex">\(W \in \mathbb{R}^{N \times N}\)</span>. The data is then clustered in this new space embedded by <span class="arithmatex">\(k\)</span> eigenvectors <span class="arithmatex">\(\mathbf{x} \in \mathbb{R}^{N \times k}\)</span>.</p>
<div style="text-align: center;">
<img src="../images/spectral_tsne_how.png" style="width:80%;">
</div>

<h3 id="the-graph-laplacian">The Graph Laplacian</h3>
<p>Given a set of data points, spectral clustering first constructs a similarity graph. Each node represents a data point, and edges represent the similarity between data points. The similarity graph can be represented by an adjacency matrix <span class="arithmatex">\( W \)</span>, where each element <span class="arithmatex">\( W_{ij} \)</span> represents the similarity between data points <span class="arithmatex">\( i \)</span> and <span class="arithmatex">\( j \)</span>.</p>
<p>Take cosine distance for example, let <span class="arithmatex">\(F \in \mathbb{R}^{N \times 768}\)</span> be the input features (from a backbone image model), <span class="arithmatex">\(N\)</span> is number of pixels, <span class="arithmatex">\(768\)</span> is feature dimension. Feature vectors <span class="arithmatex">\(f_i, f_j \in \mathbb{R}^{768}\)</span>, the cosine similarity between <span class="arithmatex">\(f_i\)</span> and <span class="arithmatex">\(f_j\)</span> is defined as:</p>
<div class="arithmatex">\[W_{ij} = \text{cosine}(f_i, f_j) = \frac{f_i \cdot f_j}{|f_i| |f_j|}\]</div>
<div style="text-align: center;">
    <img src="../images/affinity_patch.jpg" style="width:75%;">
</div>

<p>where <span class="arithmatex">\(|f|\)</span> denotes the Euclidean norm of a vector <span class="arithmatex">\(f\)</span>.</p>
<p>In matrix form, this can be written as:</p>
<div class="arithmatex">\[W = \text{cosine}(F, F) = \frac{F F^\top}{\text{diag}(F F^\top)^{1/2} , \text{diag}(F F^\top)^{1/2}}\]</div>
<p>where <span class="arithmatex">\(F F^\top \in \mathbb{R}^{N \times N}\)</span> is the matrix of pairwise dot products between the feature vectors, and <span class="arithmatex">\(\text{diag}(\cdot)\)</span> extracts the diagonal elements of a square matrix.
The resulting matrix <span class="arithmatex">\(W = \text{cosine}(F, F)\)</span> is an <span class="arithmatex">\(\mathbb{R}^{N \times N}\)</span> matrix, where each element <span class="arithmatex">\((i, j)\)</span> represents the cosine similarity between the <span class="arithmatex">\(i\)</span>-th and <span class="arithmatex">\(j\)</span>-th feature vectors.</p>
<p>The degree matrix <span class="arithmatex">\( D \)</span> is a diagonal matrix where each element <span class="arithmatex">\( D_{ii} \)</span> is the sum of the similarities of node <span class="arithmatex">\( i \)</span> to all other nodes.</p>
<div class="arithmatex">\[
D_{ii} = \sum_{j=0}^{N} W_{ij}
\]</div>
<p>The unnormalized <a href="https://en.wikipedia.org/wiki/Laplacian_matrix">graph Laplacian</a> is:</p>
<div class="arithmatex">\[
L = D - W
\]</div>
<p>The normalized graph Laplacian has two common forms:</p>
<ol>
<li>Symmetric normalized Laplacian:</li>
</ol>
<div class="arithmatex">\[
L_{\text{sym}} = D^{-1/2} L D^{-1/2} = I - D^{-1/2} W D^{-1/2}
\]</div>
<ol>
<li>Random walk normalized Laplacian:</li>
</ol>
<div class="arithmatex">\[
L_{\text{rw}} = D^{-1} L = I - D^{-1} W
\]</div>
<h3 id="normalized-cuts">Normalized Cuts</h3>
<p>Normalized Cuts (Ncut) is a method for partitioning a graph into disjoint subsets, aiming to minimize the total edge weight between the subsets relative to the total edge weight within each subset. The Ncut criterion is particularly useful for ensuring balanced partitioning, which prevents trivial solutions where one cluster might be significantly smaller than the other.</p>
<div style="text-align: center;">
<img src="../images/graph_cut.png" style="width:100%;">
</div>

<p>The normalized cut criterion is defined as:</p>
<div class="arithmatex">\[
\text{Ncut}(A, B) = \left(\frac{\text{cut}(A, B)}{\text{assoc}(A, V)}\right) + \left(\frac{\text{cut}(A, B)}{\text{assoc}(B, V)}\right)
\]</div>
<p>Where:</p>
<ul>
<li>
<p><span class="arithmatex">\( A \)</span> and <span class="arithmatex">\( B \)</span> are two disjoint subsets (clusters) of the graph.</p>
</li>
<li>
<p><span class="arithmatex">\( \text{cut}(A, B) \)</span> is the sum of the weights of the edges between the subsets <span class="arithmatex">\( A \)</span> and <span class="arithmatex">\( B \)</span>:</p>
</li>
</ul>
<div class="arithmatex">\[
\text{cut}(A, B) = \sum_{i \in A, j \in B} W_{ij}
\]</div>
<ul>
<li><span class="arithmatex">\( \text{assoc}(A, V) \)</span> is the sum of the weights of all edges attached to nodes in subset <span class="arithmatex">\( A \)</span> (similar definition for <span class="arithmatex">\( B \)</span>):</li>
</ul>
<div class="arithmatex">\[
\text{assoc}(A, V) = \sum_{i \in A, j \in V} W_{ij}
\]</div>
<p>The goal is to find a partition that minimizes the Ncut value, which balances minimizing the inter-cluster connection (cut) with maintaining strong intra-cluster connections (association).</p>
<h3 id="solving-the-normalized-cut-using-eigenvectors">Solving the Normalized Cut Using Eigenvectors</h3>
<p>To solve the Ncut problem, we reformulate it as a problem of finding the eigenvectors of a normalized graph Laplacian. Hereâ€™s how this works:</p>
<h4 id="mathematical-formulation">Mathematical Formulation</h4>
<p>Let <span class="arithmatex">\( \mathbf{x} \)</span> be an indicator vector such that:</p>
<div class="arithmatex">\[
x_i = 
\begin{cases} 
1 &amp; \text{if node } i \in A \\
-1 &amp; \text{if node } i \in B 
\end{cases}
\]</div>
<p>The cut value <span class="arithmatex">\( \text{cut}(A, B) \)</span> can be rewritten in terms of <span class="arithmatex">\( \mathbf{x} \)</span> as:</p>
<div class="arithmatex">\[
\text{cut}(A, B) = \frac{1}{4} \sum_{i,j} W_{ij} (x_i - x_j)^2 = \mathbf{x}^\top L \mathbf{x}
\]</div>
<p>Where <span class="arithmatex">\( L = D - W \)</span> is the unnormalized graph Laplacian.</p>
<p>The association <span class="arithmatex">\( \text{assoc}(A, V) \)</span> is given by:</p>
<div class="arithmatex">\[
\text{assoc}(A, V) = \mathbf{x}^\top D \mathbf{1}_A
\]</div>
<p>Here, <span class="arithmatex">\( \mathbf{1}_A \)</span> is a vector that is 1 for elements in <span class="arithmatex">\( A \)</span> and 0 elsewhere.</p>
<p>The Ncut problem can thus be rewritten as:</p>
<div class="arithmatex">\[
\text{Ncut}(A, B) = \frac{\mathbf{x}^\top L \mathbf{x}}{\mathbf{x}^\top D \mathbf{x}}
\]</div>
<p>Minimizing this directly is NP-hard. However, it can be relaxed into a generalized eigenvalue problem, because the above eq is close to the <a href="https://en.wikipedia.org/wiki/Rayleigh_quotient">Rayleigh quotient</a> which is minimized by solving eigenvectors. By relaxing the constraint that <span class="arithmatex">\( x_i \)</span> takes only discrete values (1 or -1), we allow <span class="arithmatex">\( \mathbf{x} \)</span> to take real values, and the problem becomes finding the eigenvector corresponding to the second smallest eigenvalue of the generalized eigenvalue problem:</p>
<div class="arithmatex">\[
L \mathbf{y} = \lambda D \mathbf{y}
\]</div>
<p>To make it a simple eigenvalue solving, that can be solved by most eigenvector solvers. 
Move <span class="arithmatex">\(D\)</span> to the left side of the equation. this is equivalent to finding the eigenvectors of the normalized Laplacian:</p>
<div class="arithmatex">\[
D^{-1/2} L D^{-1/2} \mathbf{y} = \lambda \mathbf{y}
\]</div>
<h4 id="proof-of-minimization">Proof of Minimization</h4>
<p>The eigenvector approach is derived from the relaxation of the original NP-hard problem. By solving the generalized eigenvalue problem:</p>
<div class="arithmatex">\[
L \mathbf{y} = \lambda D \mathbf{y}
\]</div>
<p>We are effectively minimizing the <a href="https://en.wikipedia.org/wiki/Rayleigh_quotient">Rayleigh quotient</a>:</p>
<div class="arithmatex">\[
\frac{\mathbf{y}^\top L \mathbf{y}}{\mathbf{y}^\top D \mathbf{y}} = \frac{\mathbf{y}^\top D^{-1/2} L D^{-1/2} \mathbf{y}}{\mathbf{y}^\top  \mathbf{y}}
\]</div>
<p>The Rayleigh quotient directly reflecting the Ncut objective. The solution of Rayleigh quotient is eigenvectors</p>
<div class="arithmatex">\[
\text{Ncut}(A, B) = \frac{\mathbf{x}^\top L \mathbf{x}}{\mathbf{x}^\top D \mathbf{x}} = \frac{\mathbf{x}^\top D^{-1/2} L D^{-1/2} \mathbf{x}}{\mathbf{x}^\top \mathbf{x}}
\]</div>
<p>thus, solving eigenvector <span class="arithmatex">\(\mathbf{y}\)</span> of <span class="arithmatex">\(D^{-1/2} L D^{-1/2} = \lambda \mathbf{y}\)</span> is equal to solving the graph cut solution <span class="arithmatex">\(\mathbf{x}\)</span>:</p>
<div class="arithmatex">\[ 
    \mathbf{x} = \mathbf{y} 
\]</div>
<h4 id="laplacian-vs-affinity">Laplacian vs Affinity</h4>
<p>Normalized Cuts can also be solved by eigenvectors of <span class="arithmatex">\(D^{-1/2} W D^{-1/2} \)</span>, instead of <span class="arithmatex">\(D^{-1/2} L D^{-1/2} \)</span>, where <span class="arithmatex">\(L = D - W\)</span>. They have the same eigenvectors:</p>
<div class="arithmatex">\[\begin{aligned}
D^{-1/2} (D - W) D^{-1/2} &amp;= Y \Lambda Y^T \\
I - D^{-1/2} W D^{-1/2} &amp;= Y \Lambda Y^T \\
D^{-1/2} W D^{-1/2} &amp;= Y (I - \Lambda) Y^T
\end{aligned}\]</div>
<h4 id="eigenvectors-and-clustering">Eigenvectors and Clustering</h4>
<p>The eigenvector corresponding to the second smallest eigenvalue (also called the Fiedler vector) provides a real-valued solution to the relaxed Ncut problem. Sorting the nodes based on the values in this eigenvector and choosing a threshold to split them yields an approximate solution to the Ncut problem.</p>
<p>Each subsequent eigenvector can be used to further partition the graph into subclusters. The process is as follows:</p>
<ol>
<li>Compute the symmetric normalized Laplacian <span class="arithmatex">\( L_{\text{sym}} \)</span>.</li>
<li>Compute the eigenvectors <span class="arithmatex">\( \mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_k \)</span> corresponding to the smallest <span class="arithmatex">\( k \)</span> eigenvalues.</li>
<li>Use <span class="arithmatex">\( \mathbf{x}_2 \)</span> (the Fiedler vector) to divide the graph into two clusters.</li>
<li>For multi-way clustering, use the next eigenvectors <span class="arithmatex">\( \mathbf{x}_3, \mathbf{x}_4, \dots \)</span> to further hierarchically subdivide these clusters.</li>
</ol>
<div  style="text-align: center;">
<video width="80%" controls muted autoplay loop>
  <source src="../images/n_eigvecs.mp4" type="video/mp4">
</video>
<p>Video: Heatmap is cosine distance of eigenvectors, w.r.t the mouse pixel (blue point).</br>
Reduce `n_eig` hierarchical grow the object heatmap</br>
try it at <a href="https://huggingface.co/spaces/huzey/ncut-pytorch" target="_blank">ðŸ¤—HuggingFace Demo</a> (switch to tab "PlayGround")
</div>

<h4 id="example-eigenvector-visualization">Example: Eigenvector Visualization</h4>
<p>Let's visualize how the eigenvectors divide the graph into clusters using our toy example.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_blobs</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">eigh</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics.pairwise</span><span class="w"> </span><span class="kn">import</span> <span class="n">rbf_kernel</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Generate synthetic data with 4 clusters</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cluster_std</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1"># Compute the similarity matrix using RBF (Gaussian) kernel</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">W</span> <span class="o">=</span> <span class="n">rbf_kernel</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># Degree matrix</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1"># Unnormalized Laplacian</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">L</span> <span class="o">=</span> <span class="n">D</span> <span class="o">-</span> <span class="n">W</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c1"># Normalized Laplacian (symmetric)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">D_inv_sqrt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">L_sym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D_inv_sqrt</span><span class="p">,</span> <span class="n">L</span><span class="p">),</span> <span class="n">D_inv_sqrt</span><span class="p">)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="c1"># Compute the eigenvalues and eigenvectors of the normalized Laplacian</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">L_sym</span><span class="p">)</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="c1"># Plot the first few eigenvectors</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="n">k</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># number of clusters</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">eigvecs</span><span class="p">[:,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eigenvector </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> - Dividing the Graph&quot;</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="c1"># Use the first k eigenvectors to form a matrix U</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="n">U</span> <span class="o">=</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">]</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="c1"># Normalize U</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="n">U_norm</span> <span class="o">=</span> <span class="n">U</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="c1"># Perform k-means clustering on U_norm</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">U_norm</span><span class="p">)</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="c1"># Plot the clusters</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Spectral Clustering: Clusters Found&quot;</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<div style="text-align: center;">
<img src="../images/dots_eig.jpg.png" style="width:100%;">
</div>

<ul>
<li>
<p>The 1-st eigenvector generally corresponds to the global structure (often related to the connected components of the graph).</p>
</li>
<li>
<p>The 2-nd eigenvector splits the graph into 2 clusters.</p>
</li>
<li>
<p>Subsequent eigenvectors further hierarchically splits the data into more detailed sub-clusters.</p>
</li>
</ul>
<div style="text-align: center;">
<img src="../images/dots_kmeans.png" style="width:60%;">
</div>

<h4 id="a-good-eigenvector-solver">A Good Eigenvector Solver</h4>
<p>Solving the full eigenvector <span class="arithmatex">\(\mathbf{x} \in \mathbb{R}^{N \times N}\)</span> is computational expensive, methods has been developed to solve top k eigenvectors <span class="arithmatex">\(\mathbf{x} \in \mathbb{R}^{N \times k}\)</span> in linearly complexity scaling. In particular, we use <a href="https://pytorch.org/docs/stable/generated/torch.svd_lowrank.html">svd_lowrank</a>.</p>
<ul>
<li>
<p>Reference: </p>
<p>Nathan Halko, Per-Gunnar Martinsson, and Joel Tropp, Finding structure with randomness: probabilistic algorithms for constructing approximate matrix decompositions, 2009.</p>
</li>
</ul>
<h3 id="summary">Summary</h3>
<p>The Normalized Cuts algorithm aims to partition a graph into subgraphs while minimizing the graph cut value. It embeds the data points into a lower-dimensional space using the eigenvectors of a Laplacian matrix derived from the data's similarity graph.</p>
<p>Eigenvectors are:</p>
<p>1) soft-cluster assignments, eigenvector in [-1, 1], -1 or 1 are extreme assignments, 0 means assigned to neither cluster. </p>
<p>2) <span class="arithmatex">\(n\)</span> eigenvectors can hierarchically divide into <span class="arithmatex">\(2^n\)</span> sub-graphs.</p>
<hr />
<h2 id="nystrom-like-approximation">Nystrom-like Approximation</h2>
<p>The Nystrom-like approximation is our new technique designed to address the computational challenges of solving large-scale graph cuts. </p>
<p><strong>An intuition</strong>: Nystrom approximation solve the large-scale problem on a small sub-sampled set, then propagate the solution from the small set to the large set.</p>
<div style="text-align: center;">
<img src="../images/subsample.png" style="width:80%;">
</div>

<p>The approach involves three main steps: (1) sub-sampling a subset of nodes, (2) computing the Normalized Cut (Ncut) on the sampled nodes, and (3) propagating the eigenvectors from the sampled nodes to the unsampled nodes.</p>
<h3 id="sub-sampling-the-affinity-matrix">Sub-sampling the Affinity Matrix</h3>
<p>The affinity matrix <span class="arithmatex">\( W \)</span> is partitioned as follows:</p>
<div class="arithmatex">\[
W = \begin{pmatrix}
A &amp; B \\
B^\top &amp; C
\end{pmatrix}
\]</div>
<p>where:</p>
<ul>
<li>
<p><span class="arithmatex">\( A \in \mathbb{R}^{n \times n} \)</span> is the submatrix of weights among the sampled nodes,</p>
</li>
<li>
<p><span class="arithmatex">\( B \in \mathbb{R}^{(N-n) \times n} \)</span> is the weights between the sampled nodes and the remaining unsampled nodes,</p>
</li>
<li>
<p><span class="arithmatex">\( C \in \mathbb{R}^{(N-n) \times (N-n)} \)</span> is the weights between the unsampled nodes.</p>
</li>
</ul>
<p><strong>Computation loads</strong>: <span class="arithmatex">\( C \)</span> is a very large matrix that is computationally expensive to handle. <span class="arithmatex">\( B \)</span> is also expensive to store and compute once sampled nodes <span class="arithmatex">\( n \)</span> gets large, although <span class="arithmatex">\( n \)</span> (the number of sampled nodes) is much smaller than <span class="arithmatex">\( N \)</span> (the total number of nodes), a better quality of  Nystrom approximation requires <span class="arithmatex">\( n \)</span> to be larger, thus makes <span class="arithmatex">\( B \)</span> a large matrix.</p>
<h3 id="a-good-sampling-strategy-fps">A Good Sampling Strategy: FPS</h3>
<p>An effective sampling strategy is crucial for obtaining a good approximation of the Ncut. Farthest Point Sampling (FPS) is used because it ensures that the sampled nodes are well-distributed across the graph. 
We use a tree-based QuickFPS algorithm developed in </p>
<ul>
<li>
<p>Reference: </p>
<p>QuickFPS: Architecture and Algorithm Co-Design for Farthest Point Sampling in Large-Scale Point Cloud, Han, Meng and Wang, Liang and Xiao, Limin and Zhang, Hao and Zhang, Chenhao and Xu, Xiangrong and Zhu, Jianfeng, 2023</p>
</li>
</ul>
<p>As a side note for speed, for high-dimensional input model features <span class="arithmatex">\(F \in \mathbb{R}^{N \times 768}\)</span> where <span class="arithmatex">\(768\)</span> is feature dimension, FPS can be computationally expensive for large <span class="arithmatex">\(768\)</span>. To mitigate this, Principal Component Analysis (PCA) is used to reduce the dimensionality of the features to <span class="arithmatex">\(F' \in \mathbb{R}^{N \times 8}\)</span>. PCA is only applied in the FPS sampling step, but not to the affinity graph <span class="arithmatex">\(W\)</span>.</p>
<h3 id="accounting-for-indirect-connections">Accounting for Indirect Connections</h3>
<p>Unsampled nodes can act as bridges between clusters, and ignoring these connections could lead to inaccurate cluster assignments. To address this, the original Nystrom method [2] approximates the eigenvectors by solving the following matrix <span class="arithmatex">\( S \)</span>:</p>
<div class="arithmatex">\[
S = A + A^{-1/2} B B^\top A^{-1/2}
\]</div>
<p>Here, the term <span class="arithmatex">\( A^{-1/2} B B^\top A^{-1/2} \in \mathbb{R}^{n \times n} \)</span> accounts for indirect connections between the sampled nodes by considering the influence of the unsampled nodes.</p>
<p>In our method, we solve for eigenvectors on the matrix <span class="arithmatex">\( S \)</span> given by:</p>
<div class="arithmatex">\[
S = A + \left({D_{\text{r}}}^{-1} B\right) \left(B {D_{\text{c}}}^{-1}\right)^\top
\]</div>
<p>where <span class="arithmatex">\( D_{\text{r}} \)</span> and <span class="arithmatex">\( D_{\text{c}} \)</span> are the row and column sums of matrix <span class="arithmatex">\( B \)</span>, respectively. </p>
<p>the term <span class="arithmatex">\( \left({D_{\text{r}}}^{-1} B\right) \left(B {D_{\text{c}}}^{-1}\right)^\top \in \mathbb{R}^{n \times n}\)</span> is the indirect random walk probabilities.</p>
<h4 id="example-case-for-indirect-connections">Example Case for Indirect Connections</h4>
<div style="text-align: center;">
<img src="../images/indirect_vs_17.png" style="width:80%;">
</div>

<div style="text-align: center;">
<img src="../images/indirect_vs_12.png" style="width:80%;">
</div>

<p>This example shows when indirect connection is important. In the bottom example, the connected components of the graph is altered, thus will lead to incorrect approximation. After adding indirect connection, the graph become correctly connected.</p>
<h4 id="reduce-computation-loads-for-indirect-connections">Reduce Computation Loads for Indirect Connections</h4>
<p>Given that <span class="arithmatex">\( B \)</span> has dimensions <span class="arithmatex">\( (N-n) \times n \)</span>, <span class="arithmatex">\(N\)</span> is large, directly storing and computing with <span class="arithmatex">\( B \)</span> can be prohibitively expensive. To overcome this, we reduce the number of unsampled nodes by applying PCA. If the feature size is <span class="arithmatex">\( 768 \)</span>, let <span class="arithmatex">\( F_A \in \mathbb{R}^{n \times 768} \)</span> be the feature matrix for the sampled nodes, and <span class="arithmatex">\( F_B \in \mathbb{R}^{(N-n) \times 768} \)</span> be the feature matrix for the unsampled nodes. After applying PCA, <span class="arithmatex">\(m\)</span> is the PCA-ed dimension, the reduced feature matrix <span class="arithmatex">\( F_B' \in \mathbb{R}^{m \times 768} \)</span> represents the unsampled nodes, where <span class="arithmatex">\( m \ll (N-n) \)</span>. Thus, <span class="arithmatex">\( B' = d(F_A, F_{B'}) \)</span> becomes a matrix of size <span class="arithmatex">\( \mathbb{R}^{m \times n} \)</span>, significantly reduce computation loads and memory usage.</p>
<h3 id="k-nearest-neighbors-knn-propagation">K-Nearest Neighbors (KNN) Propagation</h3>
<div style="text-align: center;">
<img src="../images/knn_propagate.png" style="width:80%;">
</div>

<p>After computing the eigenvectors <span class="arithmatex">\( \mathbf{X}' \in \mathbb{R}^{n \times C} \)</span> on the sub-sampled graph <span class="arithmatex">\( S = A + \left({D_{\text{r}}}^{-1} B'\right) \left(B' {D_{\text{c}}}^{-1}\right)^\top \in \mathbb{R}^{n \times n} \)</span> using the Ncut formulation, the next step is to propagate these eigenvectors to the full graph. Let <span class="arithmatex">\( \mathbf{\tilde{X}} \in \mathbb{R}^{N \times C} \)</span> be the approximated eigenvectors for the full graph, where <span class="arithmatex">\( N \)</span> is the total number of nodes. The eigenvector approximation <span class="arithmatex">\( \mathbf{\tilde{X}}_i \)</span> for each node <span class="arithmatex">\( i \leq N \)</span> in the full graph is obtained by averaging the eigenvectors <span class="arithmatex">\( \mathbf{X}'_k \)</span> of the top K-nearest neighbors from the subgraph:</p>
<div class="arithmatex">\[
\mathcal{K}_i = \text{KNN}(\mathbf{A}_{*i}; n, K) = argmax_{k \leq n} \sum_{k=1}^{K} \mathbf{B}_{ki}
\]</div>
<div class="arithmatex">\[
\mathbf{\tilde{X}}_i = \frac{1}{\sum_{k \in \mathcal{K}_i} \mathbf{B}_{ki}} \sum_{k \in \mathcal{K}_i} \mathbf{B}_{ki} \mathbf{X}'_k 
\]</div>
<p>Here, <span class="arithmatex">\( \text{KNN}(\mathbf{A}_{*i}; n, K) \)</span> denotes the set of K-nearest neighbors from the full-graph node <span class="arithmatex">\( i \leq N \)</span> to the sub-graph nodes <span class="arithmatex">\( k \leq n \)</span>. In other words, the eigenvectors of un-sampled nodes are assigned by weighted averaging top KNN eigenvectors from sampled nodes.</p>
<p>The propagation step is only when <span class="arithmatex">\(B \in \mathbb{R}^{n \times (N-n)} \)</span> is computed (but not stored), recall that the full <span class="arithmatex">\( B \)</span> is too large to store, our implementation divide the propagation into chunks, where each <span class="arithmatex">\(q\)</span> size chunk <span class="arithmatex">\(B_i \in \mathbb{R}^{n \times (q)} \)</span> is feasible to store, each chunk <span class="arithmatex">\(B_i\)</span> is discarded after the propagation. In practice, the KNN propagation is the major speed bottle-neck for NCUT on large-scale graph, but KNN propagation is easy to parallelize on GPU. </p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># GPU speeds up the KNN propagation</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">eigvectors</span><span class="p">,</span> <span class="n">eigvalues</span> <span class="o">=</span> <span class="n">NCUT</span><span class="p">(</span><span class="n">num_eig</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="visualizing-ncut-eigenvectors">Visualizing NCUT Eigenvectors</h2>
<div style="text-align: center;">
<img src="../images/spectral_tsne_how.png" style="width:80%;">
</div>

<p>The input image features <span class="arithmatex">\( F \in \mathbb{R}^{N \times 768} \)</span> are embedded into eigenvectors <span class="arithmatex">\( \mathbf{x} \in \mathbb{R}^{N \times k} \)</span>, where <span class="arithmatex">\( N \)</span> is the number of pixels, <span class="arithmatex">\( 768 \)</span> is the feature dimension, and <span class="arithmatex">\( k \)</span> is the number of eigenvectors. We use t-SNE or UMAP on the eigenvectors for visualization. </p>
<p>3D t-SNE is computed on eigenvectors <span class="arithmatex">\( \mathbf{x} \in \mathbb{R}^{N \times k} \)</span>, resulting in a color matrix <span class="arithmatex">\( \mathbb{R}^{N \times 3} \)</span>. RGB values are assigned to each pixel based on its 3D t-SNE embedding.</p>
<div style="text-align: center;">
<img src="../images/raw_eigenvectors.png" style="width:80%;">
</div>

<p>Alternatively, in the old days before t-SNE comes out, K-means clustering are applied to the eigenvectors. Compares t-SNE with K-means, t-SNE has two advantages: (1) continuous color gradients instead of discrete clusters, (2) t-SNE color reflects distances (e.g., distance between purple vs. red &lt; green vs. red). K-means colors are arbitrary.</p>
<div style="text-align: center;">
<img src="../images/tsne_vs_kmeans.png" style="width:80%;">
</div>

<h3 id="nystrom-approximation-for-t-sne-and-umap">Nystrom Approximation for t-SNE and UMAP</h3>
<p>t-SNE and UMAP can be slow for large-scale graphs. We applied the same Nystrom-like approximation: (1) FPS sub-samples a subset of nodes, (2) t-SNE is computed on the sampled nodes, and (3) KNN propagates the colors from sampled to unsampled nodes.</p>
<p>For extra speed-up, we found FPS sub-sampling (euclidean) on eigenvectors <span class="arithmatex">\( \mathbf{x} \in \mathbb{R}^{N \times k} \)</span> more effective than on the original features <span class="arithmatex">\( F \in \mathbb{R}^{N \times 768} \)</span>, because the distribution of eigenvectors. Thus, the Nystrom approximation for t-SNE requires fewer samples to perform well (we recommend 300 samples for t-SNE, 10,000 for NCUT). Note that small sampling works well for t-SNE only on eigenvectors but not on the original features. 
t-SNE with small sampling is fast on CPU, then the expensive KNN propagation step computes in GPU.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">X_3d</span><span class="p">,</span> <span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb_from_tsne_3d</span><span class="p">(</span><span class="n">eigvectors</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<blockquote>
<p>paper in prep, Yang 2024</p>
<p>[1] AlignedCut: Visual Concepts Discovery on Brain-Guided Universal Feature Space, Huzheng Yang, James Gee*, Jianbo Shi*, 2024</p>
<p>[2] Spectral Grouping Using the Nystrom Method, Charless Fowlkes, Serge Belongie, Fan Chung, and Jitendra Malik, 2004</p>
<p>[3] Normalized Cuts and Image Segmentation, Jianbo Shi and Jitendra Malik, 2000
</p>
</blockquote>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Install &amp; Quick Start">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Install & Quick Start
              </div>
            </div>
          </a>
        
        
          
          <a href="../compare/" class="md-footer__link md-footer__link--next" aria-label="Next: NCUT and t-SNE/UMAP">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                NCUT and t-SNE/UMAP
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Huzheng Yang
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/HuzeYann" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "navigation.sections"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>